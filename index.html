<script>
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
if (isMobile) {
    window.location.replace("index_mobile.html");
}

document.body.style.backgroundColor = "transparent";

const canvas = document.getElementById("bg");
canvas.style.position = "fixed";
canvas.style.top = "0";
canvas.style.left = "0";
canvas.style.zIndex = "-999";

const ctx = canvas.getContext("2d");

function resizeBg() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeBg);
resizeBg();

let mouseX = 0.5;
let mouseY = 0.5;
let t = 0;

window.addEventListener("mousemove", e => {
    mouseX = e.clientX / window.innerWidth;
    mouseY = e.clientY / window.innerHeight;
});

// Noise functions
function foregroundNoise(x, seed) {
    return Math.abs(Math.sin(x * 0.001 + seed)) * 0.8 +
           Math.abs(Math.sin(x * 0.0025 + seed * 1.9)) * 0.5 +
           Math.abs(Math.sin(x * 0.005 + seed * 2.7)) * 0.3;
}

function backgroundNoise(x, seed) {
    return Math.abs(Math.cos(x * 0.0005 + seed)) * 0.8 +
           Math.abs(Math.cos(x * 0.0012 + seed * 1.4)) * 0.6 +
           Math.abs(Math.cos(x * 0.0023 + seed * 3.2)) * 0.4;
}

// Draw one mountain layer
function drawMountainLayer(speed, color, baseRatio, maxHeightRatio, noiseFn, seed) {
    const baseY = canvas.height * baseRatio;
    const maxHeight = canvas.height * maxHeightRatio;
    const step = canvas.width / 160;
    const offset = t * speed;

    ctx.beginPath();
    ctx.moveTo(-step, canvas.height);

    for (let x = -step * 3; x <= canvas.width + step * 3; x += step) {
        let n = noiseFn(x + offset, seed);
        let h = n * maxHeight; // scale noise by maxHeight
        ctx.lineTo(x, baseY - h);
    }

    ctx.lineTo(canvas.width + step, canvas.height);
    ctx.closePath();
    ctx.fillStyle = color;
    ctx.fill();
}

function drawBg() {
    t += 3.2;

    // Background gradient
    const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
    grad.addColorStop(0, "#ff77ff");
    grad.addColorStop(0.5, "#6a00ff");
    grad.addColorStop(1, "#000014");
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Sun
    const sunSize = Math.min(canvas.width, canvas.height) * 0.11;
    ctx.beginPath();
    ctx.arc(
        canvas.width * (0.5 + (mouseX - 0.5) * 0.025),
        canvas.height * (0.34 + (mouseY - 0.5) * 0.025),
        sunSize,
        0,
        Math.PI * 2
    );
    ctx.fillStyle = "#ffcc66";
    ctx.fill();

    // Vaporwave grid
    ctx.strokeStyle = "rgba(255,0,255,0.25)";
    ctx.lineWidth = 1;
    const spacing = canvas.width / 10;
    for (let y = canvas.height * 0.6; y < canvas.height; y += spacing) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
    }
    for (let x = 0; x < canvas.width; x += spacing) {
        ctx.beginPath();
        ctx.moveTo(x, canvas.height * 0.6);
        ctx.lineTo(x + (mouseX - 0.5) * 90, canvas.height);
        ctx.stroke();
    }

    // Mountain layers: background first, foreground last
    drawMountainLayer(0.15, "#07000c", 0.86, 0.5, backgroundNoise, 1.2);
    drawMountainLayer(0.45, "#120018", 0.82, 0.5, backgroundNoise, 3.7);
    drawMountainLayer(0.85, "#1e002a", 0.78, 0.5, foregroundNoise, 7.9);
    drawMountainLayer(1.3, "#300040", 0.72, 0.5, foregroundNoise, 9.1);

    requestAnimationFrame(drawBg);
}

drawBg();
</script>
